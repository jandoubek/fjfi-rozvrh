@using System.Collections
@using System.Drawing
@using System.EnterpriseServices
@using System.Web.UI.WebControls
@using Rozvrh.Controllers
@using Rozvrh.Models
@using Rozvrh.Models.Timetable

@model Rozvrh.Models.Model

<script>

    // Olda: Still working on this  part
    
    //$(function() {
    //    $("button").button({
    //        icons: { primary: "ui-icon-pencil" },
    //        text: false
    //    });
    //});

    //function select(field) {
    //    if ($(field).hasClass("selected")) {
    //        $(field).removeClass("selected");
    //        $(field).children(".border").show();
    //        $(field).children("button").hide();
    //    }
    //    else {
    //        $(field).addClass("selected");
    //        $(field).children(".border").hide();
    //        $(field).children("button").show();
    //    }
    //}

</script>



<div class="content">
    <div id="backgroundTable">
        <div class="header">
            <div></div>
            <div>7:30</div>
            <div>8:30</div>
            <div>9:30</div>
            <div>10:30</div>
            <div>11:30</div>
            <div>12:30</div>
            <div>13:30</div>
            <div>14:30</div>
            <div>15:30</div>
            <div>16:30</div>
            <div>17:30</div>
            <div>18:30</div>
            <div>19:30</div>
        </div>
        <div class="begining"></div>
        @foreach (var day in Model.Days)
        {
            <div class="horizontal">@day.name</div>
        }
        @for (int i = 0; i < 13; i++)
        {
            <div class="vertical" style="left:@(51 + i * 50)px"></div>
        }
    </div>


    @{
        int top = 39;

        foreach (var day in Model.Days)
        {
            int dayHeight = 50;
            var dayGroups = HomeController.getGroups(Model.CustomTimetableFields.Where(m => m.day == day.name).ToList());
            foreach (var group in dayGroups)
            {
                foreach (var field in group)
                {
                    if (field is FakeTimetableField)
                    {
                        continue;
                    }
                    int width = Convert.ToInt32(field.duration) * 50;
                    int left = 100 + (Convert.ToInt32(field.time_hours) - 7) * 50;
                    int height = 50;
                    int nameHeight = 31;
                    int fieldTop = top;
                    if (group.Count >= 2)
                    {
                        height = 25;
                        nameHeight = 10;
                        if (group.Count * 25 > dayHeight)
                        {
                            dayHeight = group.Count * 25;
                        }
                        fieldTop = top + group.IndexOf(field) * 25;
                    }
        <div class="background" style="width:@(width - 4)px; height:@(nameHeight)px; background:#@field.color; left:@(left + 2)px; top:@(fieldTop + 2)px;"></div>
        <div class="name @(height < 50 ? "small" : "")" style="width:@(width - 4)px; height:@(nameHeight)px; left:@(left + 2)px;top:@(fieldTop + 2)px;">
            <div>@field.lecture_acr</div>
        </div>
        <div class="detailsBackground" style="width:@(width - 4)px; height:@(height - nameHeight - 4)px; left:@(left + 2)px;top:@(fieldTop + 2 + nameHeight)px;"></div>
        <div class="details@(height < 50 ? "Small" : "")" style="width:@(width - 6)px; height:@(height - nameHeight - 6)px; left:@(left + 2)px;top:@(fieldTop + 2 + nameHeight)px;">@field.lecturer
            <div>@field.classroom</div>
        </div>
        <div onclick="select(this)" style="width:@(width - 4)px; height:@(height - 4)px; position:absolute; left:@(left)px; top:@(fieldTop)px;">
            <div class="border" style="border-color:#@field.color;"></div>
@*            <button style="display:none">text</button>*@
        </div>
                }
            }
            top += dayHeight;
        }
    }
</div>
